import Day15.parse
import Day15.run1
import Day15.run2

object Day15 {
    data class Input(val grid: Grid<Char>, val movements: List<Coordinate<Int>>)
    fun parse(input: String): Input {
        val (g, m) = input.split("\n\n")
        return Input(
            Grid.parseCharGrid(g),
            m.toCharArray().toList().mapNotNull { Coordinate.parseDirection(it) }
        )
    }

    fun moveRobot(grid: Grid<Char>, direction: Coordinate<Int>): Grid<Char> {
        tailrec fun push(o: Char, to: Coordinate<Int>, g: Grid<Char>): Grid<Char> = when (g.get(to)) {
            '.' -> g.set(to, o)
            '#' -> grid
            'O' -> push('O', to + direction, g.set(to, o))
            else -> throw IllegalStateException()
        }
        val (robot) = grid.findAll('@')
        return push('@', robot + direction, grid.set(robot, '.'))
    }

    fun expand(grid: Grid<Char>): Grid<Char> =
        Grid(grid.m.map { it.flatMap { c ->
            when (c) {
                'O' -> listOf('[', ']')
                '@' -> listOf('@', '.')
                else -> listOf(c, c)
            }
        } })

    fun moveRobot2(grid: Grid<Char>, direction: Coordinate<Int>): Grid<Char> {
        data class Push(val o: Char, val to: Coordinate<Int>)
        tailrec fun pushV(pushes: List<Push>, g: Grid<Char>): Grid<Char> =
            if (pushes.isEmpty()) g
            else {
                val push = pushes.first()
                val todo = pushes.drop(1)
                when (g.get(push.to)) {
                    '.' -> pushV(todo, g.set(push.to, push.o))
                    '#' -> grid
                    '[' ->
                        pushV(pushes.drop(1) +
                                Push('[', push.to + direction) +
                                Push(']', push.to + direction + Coordinate.right),
                            g.set(push.to, push.o).set(push.to + Coordinate.right, '.')
                        )
                    ']' ->
                        pushV(pushes.drop(1) +
                                Push(']', push.to + direction) +
                                Push('[', push.to + direction + Coordinate.left),
                            g.set(push.to, push.o).set(push.to + Coordinate.left, '.')
                        )
                    else -> throw IllegalStateException()
                }
            }
        tailrec fun pushH(o: Char, to: Coordinate<Int>, g: Grid<Char>): Grid<Char> = when (g.get(to)) {
            '.' -> g.set(to, o)
            '#' -> grid
            '[' -> pushH('[', to + direction, g.set(to, o))
            ']' -> pushH(']', to + direction, g.set(to, o))
            else -> throw IllegalStateException()
        }
        val (robot) = grid.findAll('@')
        val r = if (direction.y == 0) pushH('@', robot + direction, grid.set(robot, '.'))
            else pushV(listOf(Push('@', robot + direction)), grid.set(robot, '.'))
//        println("after move: $direction")
//        r.print()
        return r
    }

    fun run1(input: Input): Int =
        input.movements.fold(input.grid, this::moveRobot)
            .findAll('O').sumOf { 100 * it.y + it.x }

    fun run2(input: Input): Int {
        val g = input.movements.fold(expand(input.grid), this::moveRobot2)
        g.print()
        return g.findAll('[').sumOf {
//            100 * it.y + min(it.x, input.grid.width() - it.x - 1)
            100 * it.y + it.x
        }
    }

}

fun main() {
    val input = """
        ##################################################
        #..O#.O.#..OO...O.....O....OO...OO....O...O....O.#
        #..............O..OO....O.O....#O.O.....#..OO....#
        #O....O.O...O.#.O.O..O..#......O...O......O.O....#
        #.#.OO.....#O.O..O.......#......O.#..OO...O....O.#
        #..O.O.OOO.O.O....#O.#.O..O..OO..O....O..O...OO..#
        #.OOO....#..OOO.OOOO.O.O..O..O#..O#........OO.O.O#
        #........OOOO.O.#OO....O.O.O.OOO...#...O.......OO#
        #.O......#OO..O..OOO..#...O.........OO.#.........#
        #O#..O...#...OO.#..OO.O..OO...O..O......OO...OO..#
        #.....O.OO...OOOO..O..#O...O...O.....O#.#.....O..#
        #..O.........O..OO..O..O#.OOO.#.#..OO....#O.O....#
        #..O..#.O....#.O.O.....OO..OO.#.OO.....O.....#O..#
        #.OOOOO.........O..##O#O.......O.O#O#.O..#O......#
        #O.O...O...#.O.#O......#.O#OOO...#..........O.#..#
        #....O.##..OO#OO....O.....#.......OO..........OO.#
        #..OOO.O.OO#.....OO.#.O..O#.O......O..OO.O#.O....#
        #....O....#O..O..#...O...O...#....O.#.O.##O....OO#
        #...OO.OO......OOO.OOO.#.O...O.O.OO......O....#..#
        #.O.#OO..O.....OOO...OO.....#O.....O...........O.#
        #..O...O.O.OO..#O...O.O.O.O.#O....OO.....OOO.....#
        #OO.O..O...OO.#OOOOOO.O.O.......OO.......#....O..#
        #O.O#....#...OO......#O..O.......#..O...OO#OOO...#
        #....OOO...OOO.O.O.....O...O..O#O......O.#O......#
        #O.#OO..#O.........O.O..@...#...O..O#........O...#
        #.....O......O..#.OO..#.....#...........#.OO.....#
        #O.......O.#.....O..OOOO.O.O.O..#O.O..O..O..O..#.#
        #....O...O.#O.#....O...O......O..OOO.OO..OOO....O#
        ##.OO..O.O.#.....O..O......O.O.O.#.O.O...#..#..#.#
        #.#..#.O..O#..#..O...#.O..O....O.O.O.....O.......#
        ##O..O.....OO##O.....#O.O.O.#O.O#OO.O#.OO........#
        #.OO....O.....O..#......O.OO#..O..O.O..#O..#.....#
        #...OO.OO...#......O.O.O............#..#O....OO..#
        #.OO.O.OOOO.OO.....O.#O.....O.......O......#....O#
        #.....O.O...#............#O..O....#.O....O..#.OOO#
        #...##O..O#...#OO.O...O.....OOOO..#O..O#O........#
        #...O....OO..#.#........OO......O..#O.......O.O.O#
        #...OO.OO....O..OO#.OO.O.......O.....O..O...OOOO.#
        #...O.O..O.O....#...#.........O...O...O.#OO..O...#
        #...........O#.O.O..OO.....#...O.O.......O#OO....#
        #..#O..O..#OOO..O...#OO.......O..#OOO.##O......O.#
        #.##.O......#....OOO.........O.....O.......#..O..#
        #O#....O.......O...#O..#.....#..O....O.#.O.OO...O#
        #.#O.....O#..O.#....O.OOO...#...OO....O...###..O.#
        #O.O..#..#.......O..........O.O...OO..O..#...OO..#
        #O###.O..OO..O.OO..#.O..O#...O.......#O..#OO.O.OO#
        #OO..O....O.OO#...OO...#.O.....O..O.#O..OOO......#
        #OO#..O......OO...O..O.#..O.O.....O.OOOOO.O....O.#
        #....OO..O#....OO........O..O....O#...OO....O....#
        ##################################################

        >vvv^<<<<<>^<^vv<v<<>v>^^^>^>v^<<>>^>v<^>><<v<v^>^><vv><><v>v><><>>v<<v^^<<>>^>>>>><v^<>^<>^^vv<<v^><<<^v><vv>^^<>v^^><^vv<^v<>^v^^^^<>vv^>><v<>^>^v>^>v>v<>>v<^vvvv<^<<^v><>vv><>^>^><>v<v<^v<><vv><>>v<^>>>^>><v<><^v<vvv^><v<>><^^><>>vv<vv><>^><^vvv>v<vvvvv<vv^^v<>><^^v>vv><>^^<<<^v>v>>>>>>v<^^^v<vv>vv<v>>^>^v^^^>^^>^<>><>v>v<v^^<^>>v<<><<^<<<><<<>^>v<>v<v^v>vv^^v^>^^v>>>><^v^<<>>v><><^>v^<v^>^^>^>>>vvvv>^v<>v><>^>^^<^>^<>v<v>>>>v<>v><<^^^>>^v>>^><<v>>>>^>>>><<<^>vvv<^v>>>v>vv^^vv><^>v>vv>><<>><^>>^^v>>v>v><>^<^v<v>^<>>v<^^>>v>^<v<^>>v>>^vv><<v>^^^<vv>>><v><v<<^><<^<>vv^><>v<<<<<^<^>><>v^<^<v^vv>v^^^<<<^v^v^^<v^vvv>v>v^>v>v>><><>vvv^v<>v<>>^v<^^v>><>v<vv<<^v^^>^^vv^<^<<v>^<>>v><v>>v>v>v<<>><^^v>v^<v<v<<<>v<<v^v>^>^^>>vv<vvvv^<<><><<vvvv>vvv^<<<>>^>^><<<^><>>>v^<^^<<v^<v^<<v^><v<v<v^^^>v>>^^^<<>>^><<>>><v^<v<^<><<<<<<<<^^>v^>v<vv>v<<>^>>>^v><^^>v>v><<<>v<v><>vvv>vv>v<>^v^vv^^vv><<^vvv>v>>^^<^>vv<v><<<^>vvv^^v>v>^^<><<>>><>^^^<<<<vvv>v>v<v^<<<^v<><<>>v^>>v>^>>vv^>^^>>><^vv>>v<^><^v>v^<^<v
        >>v<<v><^vvv^<><^vvvv<<>^><vvvv><^^^^><^^v<<vv^^^v<^>>><<><<^>><<vv^^^<<vv>^<<v^<<<<>>>>^>vv^<<v^v<<>^vv<>^v^^^><>^<^v>>v^<vv>v>^<^v^>><>v>v^<<^^>><<^vv^^><^>>><v<<<v^>v^<^>vv<^^v>v<<^v>v<<<vvv<v^^<^<^><<>^^<^<<<v^>^v^<v>><<<<^<^v>>>>^vvv^<<>^><^v^>v^>><^vv<^vvv>v><<<<<>^>v<v>^v^v^^>v^^v<^>>vvv>^<>vv>vv<^v^v<>vv<v^><v^v^>>^^v^>^v^^<v<<^><^^>v^><><vv<v><v>><^v>^vvvv^><v<vv><^v>^<v^<^v>v>>>^v><>>v<^^v<<>>>^<^^^^^<vv>>>>vv>^>><<>vv^<<>>v<vv^^^<>vv<^<>v><vv^<<v<^v<v>^<^v^>^>vv^>v<^^^^>v><vv>v<>>>v^v><<v^v>>^>>>^<><<v>v^<>^>>>vv^^<<><^v^<<>^<<>>><<<<<>^>^v^<^vv>^^><v>>><vv<v^<vvv<<v><>vv^v>v^<>>v^<v<><v<><<v>^vv>v^v><^^<v>^<v<>^v>v<<<>v><<v^^<v^^>vv^><v<>><>>><v><^>^v^^v<vv<v<v<<^<<><^<^<>>^>v>^v>vv>>v>v>vv><><<v<^^v^^v<^<<^><<v<^^<<>^<^^<v>^>>>vv^^<^<v<vvvv><^v^v<^^v>^>>v>^v>^v<><<v<^^>^vvv><^<<<<><^vvvv<<^v<>^vv<^><^v<v>><^^<^vv>><<v>^^vv^<v^><^>^>v^^^^>^^^>vv<v^^<^^>^^<v><<<^vv><^v^v^>v><>vvv^><<v^v<<vv^>>><vv^<v>^>>vv>>^<^v^^vv>>^>^<>^v^^>>v^><>^v^v^^^>v^v^<v^vv<<><^^^><^^>v<><>v>^^<^>>
        vv^><>vv^^><<^vv><v>>>><<^^<<vvv^^<^v^>><^v^<<><><>v><>v><<>v<>>v>v<vvv^>>vv<v<^v>>^^v>^^>v^v^^^><<vv^vvv<<^^<><v^^>^<>^>>><v>v^v^v<>^<>v<vv><v<v^^<<>^<^>>>v^>v^<<vv><><^<v>^<>>>v>^v<<<>^^<>v>>^vvv<^>>^>>^<><v^vv>v^v^^^>>^<>>vv^^^>vv^<>^v^<v^<>^>>^>>v>^>><^^^^^<vvv><v<<><v^<^>>>>^^>^>^<v>v<vv^^^vv<<<v<^^^^<>><^^vvv^vvv^<vv^v^vv<>^>vvv<<vvv<v^>><>>^<v>v>>>v^>v^v><>^>v<<^vvv<>^>^<>v<^^>v<>>>vv<<>^^<<<<vvv<v<^v>v^^<v^<v<>^v^v>^>^^v><^^^v^^<<vv><vvv^v<^>>v^^^^><<<v><><>v<><<<<>^<vvvv>v^v>v^<<^<>v^><<><><<<<v<^^^v^v^v^><^>vv^>^v>>v<v^>^<^<<^vv<>vvv>^<>>>^>><v^<<^<v^><<><>^^<vv<<v>>v>^v<>^v<>>^v<v><>^>><^>^v>v<^^^>^<^vv<^vv>^<^^<<^v^<vv^>>v^>v<^<>^^>vv<^<>vvv<^vv<<vv>vvv<^vv<<<^^<v^v<^v>^>vv<vvvvv>^<<v>^v^v^>^<>>v>><v^>v>>>>>v<>v><><^>v^^^v>^vv^<<v<>v>^>^>v<>><^>v<<vv^>v>>v<vv^>vvv>^<^^vvvv<>v>^>^<v<^^>>^^v^^<v<^^<v^vvv^>v^>^<v>>>>v>v<v>>v^<<v^v><<^>^<<>^>>>v^v><^<v^^>v>>>vv^<v^v<>vvvv<v>^^<><^v>^<<^>v><^<^>>^v>vv>v^>><>^<<^>>><<v>vv^v^>^<<vv<<>>><<^><v>^<>^>>^>vvv^<v>v<<<<<vv^>^<vv<^<v>>^<<
        >v<>^v^v<^^>v<>>>^>v^vv^^v<^^v<^v^^<<>><>>>^^^^>>v>v<v<v><<<^<><v<><^v^^v<^><v>>^v>v>>vv><><v<v^<^v<><<v<<>^<v<^^v<<<<v>>v>vv>^>vv^<^v^vv><><^>>vv<<<^>v^v<v^vv<vv<>>>^^v<vvv^<v>v^v>^>^v<^^v<><>>>^<<<><v<^v<<>^><>vvvv>vvv<><^><vvvv>vv^v>><vv<v>^v<v<>>^<vv<>>><>v>v^^v>^vvv^>v><<<^v>v<<<^^<><<><<<v>^^v<^>^^v<^<><<<^<^>v>^v^><v^^^>^^vvv^v<<<>>^>>^^^>v^<<<>>><<>v>>>v^>>^^v>v^<>^^v^><<^>^<<<>^<>^v>>><<>>^^>v<vv<<<^>>>v^v^^^v^^v>^>vv>>>>^v<^>v^<v>>v<<><^^^>>^<<^><<^>^^><<<>><<<<^>^<v^><^<v<<^^>^vv>>^<^>><>>>^v^<<v>^v^><>v^^^^^v<v>>v^v>vv><v>>^>^>^<>^v<^>vvvv<>>^>vv^^v>^^>>>^v^<<vv^v>^<^<><>>v<<<>><^v^^<^v>^v<v^<vvv<>>^>^v>>^<<^>^<<^<>^v<^>vv>^^>><<>vv><v^^v^^<^^<^^<^<v>v>>v>>>vv<>^v>>>v<vv>v<>>><<<^>>v^>><><v^<^<>^^^^vv>>v>>>v<vv>>vv^>v^^<v^<>^>v^v<^><<v>v>^<v^vvv><>>>^>>>>vv<v^v>v<<^><>v<<v>v<<<<^^v<<v<<vv^^>>vvv<v^vv>v^<v<>v^<<vv>^v^>vv>^><<><>v^><>^v<^^v<^^v>><<<^<<v>v<^^v><v><>^^vv^<<>^<>><^v<v^^<>><<^>v>>><^^^^v<<^<>v^>^v^>>^<>v>vvvv<^v<^vvv^>^>^vv<<<v>><<^^v^v>v^>vv^^<vv>^^><<^<vv>vv<<v
        ><^>^^<<<<<<v>>v^^^<<^<vv^^<<^^>>><v<^><>^>^v<><^<v^v<<<>>^<<v><v<>v<>vvv>>^vv^v^^v<^^<v><<><>>>^^v<<<<<^v><^<><^<vv<<v^^>>v<^v<^>^>v>^>>v^<<>>>><>v^<^<^><<>v<<>v^>vv^v>^<^>><<<<><v<>^><^<<^<^^>v>v>><<^>v>v>v^<^vv^^<<><><^v<>v^>><<v>>v^v>>^><<v^<v^v>^^>vvv>>v<><^^^^<<v><^>v<^v^v<vv^^^^>v>>^>><<vv<<v><^><><>v^v>v^^^^v<>^<v>v^v>v<^<><>vv<v^>v^^v>v^><<<^v^^<v^>v^<v>><<<>>v^^>>>^<>vvv^vvv>v^^<v^^^>^^vvv^>>vvvv^<<vv>>^<v<><>^>^v<^>>^v^>><><<>><<>><<^^<><<<>><>v>^^^><><^><>v<<^v^<<<>><>v^>>^^>>^^v<<vv>^^><<<vv>v>vv^<vv<>^v>>v^v^v>^v<>v<>^^^v>>>>^>v^^<^v<^<><^>^^^>^>>^<<vv<<>>><<^^<>v<v>v<<v^>^^^^>^<<<^><v^^<^>^^>v><^v><>^<^<v>^>^vv>vvvvv^>vv^>vv><>vvv^<<v^>vv<>v>vv<>v<vv<^<v>>><>>vvv^v<><>^v<^<><<>v<^<><^v>^<>><<>^v<>>>><<^^>>v>^v><><>^<v>^^v>^^^>^v^<v<<v^^<>^<^v^vvv^>>>>>v>^>^v^><<^v<<v<<v<^>^^>^<><v^>>^v>^>^^v>>>^<><>^^v>v>vv<>>><><>>^>>v<v<<^>v<<><><v><<^>>^^<v>>><^><v^^>><v<vv<^^v<v^vvv<^^v>^><vv>><^v<^v<><>vv^v^<<vv>>^vv<><<<>v>>v<^<v^v<^<^>vvv><^<<^^>v<v^v><>^v>>>v<<v^<vv><v<>>>^v^vvv<
        v<>^<<>^<^<><vv<<<<><<v^<vv<vvv>v<<<^<>v^>^^>><>>>vvvv<^<^<<>>vv<<>>v^v>^v>>v>^<<v<<^>>v^v<><v^v>>v>v<<<<v>vvv<vv><>vv^<^<v^>v><>vv^^>v<<><<><v<<^><^<<>><v<^^><<<^vv>>v^v>>vvv>vvv^><v<^<>^<^v<v><><^<v^>>v>v>><<>>><>vv>vv^<^^<v^^vvv<>><^><^<^<v<>v^^v<v^>vv><^^<^>v>>^<>>>^>>v^>^<<<vv>v<vv^<><^v<^v^>>^v>><v^v^>>><vv>>^>^v<^<^^><<v<><v><>^<v<><>v>>^>>^v>v<<v>>>^v^<<><><<<>>v<<^<v<^^<^v>>^v<<^><<<^><<^^<v^><^<^^>>>^v^v^v>vv>><>vv^vv<v^<v>^>vv<><<>^<v<><v^vvv^><vv>^^<>^^^>^>>>>^<>^><<^v<>^>vv>^<v><^^vv<v><<><v<<^^>v<<^^^<<vv<<<<^^<^^^<^>^^^<^v<><>^<vv^v>>^>v<^>><vvv<^<v^v>^>^^>><^>>><<v<>v<<v^<^^><v>>v<>^>v>>v>^<>^>vv<>><^^^^^>^>v^>v^^v<v<^v^^<<v<^vv>v<>>><v^^v>^><^<>^<^^^^vv><<^<<>^<<>v^<<<^>v>>v>vv<<<><<<v>>v^v><<>>^><<<^<v<^>^v<<<<<<<<<^^^><><v<<^><^^<>^><v^^<<>>v>^<^^<v^<>><v^v>>vv^^^v>^>>>>>^^v<^v>><><vvv>^^v>>>^v<vvv<^<^^vv^<^<^>v><<<^<<><>v^^^v<v^<<>v><vvv^<<><<>^<<v><<<vvv^v<>><^>>><<>^^v<^^<^<>^vv><vv<v<v<^<<>>^>v>>^><<<<vv><>^><><vv<^<^^^>^<v<^v<>^^v<>><><<<<^v<<^>^v<>>v>^^^>v<v>^v
        vv^^>v<^^<><<vv<>>v^^><v^<^v<<^^^><>>v<>>^<<vvv<v^<<^><<>vvv>^^>>>vv^v>^><^<v>><>><vv<v<v^>v>v><<<<>v>v^<>v>^><<^^<<<>>>v<<<<v<<^^vvv<v^<<<<>><>>^v<v>^>>>>^v^>v^<<v^>^^^^^vv<v><^<^>v>^^^<>v<v>v<<v<v<<^>^^^>^>^^^^^v<v><v^<^>^<>>^>^^vv^>^>vv<v^>>>>^v<^<>v^>v<<>>^<v<v<<<vv^>v<<^>>>^<<^^vv>^^<v<vv>vv<^v>>^<<<><v>vv^><v<<vv^v<^<<<^>>>^v<><vv>>^>v<^v<^^<>>><^v^^^<>vvv<vv>vv<<v<v<v<^vv>><^v^>^<<>>v^^v<>^vv<^^>^v^>^^^>^<<^<^<v>^v><^v^^>><^<>>^v><<<v<^vvv^<v^^>^^>v<>>v<>vv^<><v^<>^<v^>>^>v<v<vv<v^<^vv^><<^<><<<^>v^><v><<<v^v^^<<^<^<^><v<<v^v^>><^vv^<><>>>>>^>^v<v>vvv<^<<>v>v^v<^^>>vvv<^<<^>^v>v^vv><<<v^<<v>>^^^^><<<^>^^><^^<<<v>^^^><vv>><<vv^^<v<v<v<>v<^^v><^<v>^^>v^<>v>^^>vv<<vv>>v<><vvv^vv<>>^^<^<v>^v>><<v<v>^^>><vvv><^^^v><v<^>vv>>v>vv<>>^<vv<<<v>v^><><<>>v>>><>v^<v^^>v<<v><<^>^<v>>>^>vv>vv<^^^<v<<<<v<<<<>^^<>vv^><vvv<^>v><<v^^^v><^<^^<v>^<vv^<>>v<^><^^<><vv<<<>^>>vv>v^v^^<><^^<>v<<v<>v^v^>^^<>v<<^v>v^v<v>v>v>v<>^^^<>>^><v>>^^v>v><^^vv^>^>^<^><v^vvvv>v><^>v^v<>vv>^>v^^v^v^v<^>>v^^>>>v^v>>^^<
        ^>>>^v>v<v<<^>^^v^v>><<^><<<^>>><v>^<><<v>^<^><^v>><v^<v>>v>><v^^v<v^v^v>vv<v>^^>v^vvv<>v<^v<^^><vv>>>^>>^v<<^<<^^^>v^><vvv^><^>^>><<<^v><^v^>v><<<^<><^^>v<><>^<<v^<v<<><^><v<vv>v>><v<>^v<<<><^^<^<^v><<>vv^^<>>^^>>^^>v^v>v<>>>v<>v>>^v<<><v<<>vv^^^v<<>^^<^<vv^<<<<<><><^v<<>^<><^>^<<>>><^>^><v^>><vv<<^v^^^><vvvv^>vvv^<<vv^vv<^v>v^<^<^>>v^^><^^v^>>^<^v<>>^v^><>v>^vv^>><^v>>v<v^v>>v^v<<^^>v<v<>>>^^v><>^<>vvv>v<v<vv^><^^^^v<v>v^v^v<v<><<<>>^^<^<^>><^><>^>^<>>v<^v<^^^vv><v>^^v^<v>v^<><^v<<^v<>^^<<<<^^<<<^><>>><vv<>><<^vv>vv<^>v>>vv<>^<>^^^>^<<>>v<^<^>><v>v>^>v<^<>v<><<^v^<>^v^^<v>v>^v<><<^^<^>^^><><v^>vv<<^v><>vv>^<^^vvvv>>^>>^>>^><>>^<^vvvv^<<^v<>>v^<^<^>v^>v^<<^>><^<vv>^^<><>>v^<>vv><>^<><^>^<>>v^^<v<v>^<<>^<<^v^><<v>v<^^vvvv>>v<>>^^^<^^>><v^^^<v^v><^>^vv>vv<<>^<<<^^v<^v^><^<<>v<>>v<v<v>>^<><vv<<>>v<^v^>^v>>^<>v<<<>v><v^v>>^><^<vv^vvvv^v<>vvv>><^<<><><<^^v^^^^^^<^^v<^^^^<v^^^v^<<^<><<<>v<><^v><^<^v>>v>v<<^^<vv<<<^><^<vv<><<^<>>><>><vvv^v^<v^^<^<><^v>^v<vv>vvv^v^>><v<>^v^<><^^>v<v>>^<>>>v<<
        >><v<v<v<^<><v>>>>v<v<v>>^v><v<<>^v^<<v<<>>>vv^vv><^>><^v>^<>v<^^v><<<vv>>v>><><><^^<vvv<>v^^<^<^v<<v>>><><>^v>v>^^>^^><>^^^^><vv<<<^>v>>v^><<^<>^><v<v>>^>v<^>>v^>><<<^v^^<v<^<>^<^v<v>^<>v<>>vv<^^^<>vvv><>^>^><vvv><v^v<>v<v<^^^>^^v>><^^^>^^^vvv<<^<^^>vvv^<v>>^<v<><<<v>><^vvv^v^v^v^^v^>>^><v<^<<v><^v>^>^v>v^>vv>^v^<>v<v>v>v^^<^^v^><^v<v<v<>^<v<<vv^^^>vvv><v^<v>>>v<v^^<><^>v^>^^><^vv>><>^v>>^><v<^<^<><v<>^v^^>>v>^vv<><>v<>>v<>vvv^<>>v<<^>v<>^^^<^<<vv^^v>v^<<<^>vv<><^^v^v<vv>^<<>v>v<>^<>>><<<vvv<^<>v^^v<><<^v><^><v<^>>>v<<^<v^<^<v>v>^><^<^>v^^v>^<>vv<^>^<^v^<<<<>><^v<>^<^>^>>>vv<<<v>>>>>v>v<v^<v^<^><^^<>v^^^v^v<<^v<<<^^>>>><v^^v<^^v^vv^^>v>^^<>vvvv<>><v>><v^^>^<>>>v^^v^<<<^>><^v>><>>^^>v>>>>v<v><><v<^^><<v>><v^v^v>^>>>^vv^^^>>v<^vvv<<>>v^vv<<^>>^^>>v<v^^>^<v>>v<v<v>^^^>><><><^^<>v^><>^^>^<v^^<vv^vv<<<^vv<^>><<v>^^<<v<^v^^><><v^<v><v<<>><vvvv^^<<^v^><<^v>>v>><^^<^>>^v<<^>vv<<vv^<<^<^vv^v><^<><vv<v^<>>v^vv<<<^>^v<^<^<>^v><v^^^><v<<v>v>^^<v>v><^<v<<>v^^^v^<>>^<<v^>^^<v>^>v>v<v<^v<v>vv<>><^><
        ^vv>v>vv^>^vv<>v>vv^<^^><>>^v^<^v<>^vvv^vvvv>>><^><<^<<v<^^<><>^^v>><<^vv^^^<>^v>v^^v^^^^><<>^<<><^v^<><^>v<>^v<^^v><v><v>^v<><<<>^v^<^<<v<<^^^<v^^>>v^>>^>^<v<>><<>v>v^<<>>^<v^<<<^v<^<<v^vv>v<>vv^^v^<<^<v^>v^vv<^>v^v><v<><<^v^^<<^v>v><>v>>>^>^^<<^><><><>>^>>^>vv^vv>^>>>v>v^<>><<v<^>><^^^>^v^<<vv>><>v><>vv>><^<^^>^^<^v>v^v>^^><<v<>vv<<<<<<v<>^^><^^<<<^><v>v><>v^<v^>vvv><><>^<>vv>^>^v^v<<^^<v>>v>>>vv<>>vv>^v>>^>>><<vv<vv<<<<vv^^><><>v<><^>^><<>^^^<v<^><vv<><<v^^>^^^^>><><^v>><<^<>^<<<v^<<<><^^^^^^><<<<<<^<<v>^<<<<<<>>><^^^vvvv<><^^>^^^v<>^^>vv<^>>>>><v>^><v^<>^<<v^v>^><v>>^<vvv^v<v><^>><>>^<vvv<^^>>v^<^^>^^<^v<^v^>^<>v<>>^>v<>^>v^>^<v^<^>^^vvv^^<^v<>v<v>v^v<>v^>^>^>v^<v<<<>vv^v^<<>^v>>v<^^^v>v><>>v^v>v<<^><<^v^<<v>>^^v^v^>><<v>v<^^>>>v^v>^^<>^<vv^><^vv>>v<^^><<^^>^><>>^<<v>>^^v<^^>^vv^<>^^v>v<^^>v>v^v>^<^v^<>^vv>^>>>>vv<v^v>v<^^<><^<^<v<^^^<<^v<^vv<v>v<<v^^<v<^v^<<v<^^v>>>>vvvv^>>^v<><>v<v<>^<<<^>>^><^<>>v>>v<<>v<^^>v<>><<v<vvvv<<<<v^v^v^>^>>>>>><><^^^>v><<<>^>^>v<><^vv^^>>v>v<><><^><<>v
        >>>vv>><<<>v<^<<<^v><^^><^vv^<<^^^^><<>^><^>v^^><v^^<^<<<><^>>^v>>>v>vv<<<^<>vvv><<^<<^^^vv^^v^^v^^v^>^v>>>v^>v>vv<<<^<v>v^v<<^>>>><^<^>>^^^^>>>>vv>v<>><vvv^<>^<^<v^^>>^vv^^>^^><v^^<^v<^<v<>v^^vv<<^^<>v^^^^>^v<^<><^^v^>v>vv<vv<^v><>^v^<<<<^^>>>>^<^vv><>v>>>^v^><v><^^v^><<^<v<vv^>>^v<v>^v^<^<<<>><^^>><>^^v^>^^^>^<^v<^<<^>>^<>^><<^vv<v<v>>vv^^<<vv^v<vv>>vv>v><^v^^^>><>v<v><>v>>>>v^>><>>>^<v^<<<vv>^<<v<^^<^<<^<>^v>vv<>vv<^^<>>>v><v^^v><v>>><vv<^>^^v>v<^v^<v<^><>v<vv>>v><v>><>^v^v>vvv<^<<v>><<vv<^<^^v^^^^^>^><<<v^>>^^^v<v^vv<^^v^<<<>>^<v>v^>^>^>v<v^<v^v<>v>^^<<v>^><>vv<vvv<>><vvvv<<^<<>v<>>^^>v<^<vv^><><vv<>>vv>>^^^>^^v^^><<>>>v<><<^>vvv>^<v^v<<>>>v<>^v<^vv^vv^><<^^<vvv^^>vv^><^<<>v><><>>>^<^v^>v<^<^vvvv<v^v<<^^^v<<>>>>><^^v>>^<^^^<vv><<^^<^<>>^<<>^vv^v<>>>^vvv^v>^^><>v^<><^>vvvv^><<v^^vv^v^>v^<<^<><<vvv>v>v><>^<v<<<^>vv^^v<>>^<>>v>>^^v^^v^^^v><<>^<>><>v<<vv>>vvvv<<<v<^<^>^>^v^vvv>^<>^v><<^>^<^>^<<>v<vv<>^vvv^v^v^><<v^^v<^^^>^vv<^>><^^v^<><^<<>>vv^>^^<v<>>v<^^^^<v^^^>v>>v>v<^^^^v^><<>vv><v
        v<v<>>>v^^^^^<v^<<v>v^<>v^^^>>v^vv^^^>>v<>^v>v>v<<^v><v^<><^v<<<v>v<v^>^^><^<>><><^^v<^vv>^v^vv>>>v>^<>^><vv><^v<>>^<<>^<v^^v^<<<>><>^^<>^^<^>^>^><<<^v><^>>^>v^v<v><v^v<<>^^v>v^<^vv^<<>v<^v^><><<<vvvvv<^^<>^vv>vv^^^<^^<^^>>^<>>>>><^v<v^^<<<>>^>>vv^<^<^<>><vvv<<>vv<>v>^>v^^v<>^v>>v<<^>vv^v^>^v^^v>v>v>><>^>^^v<v^<v^^^v^<v<<<><^>^<^>>^>><<><^><v>vv<^v><vv<^v>v<^vv^<><<^<^>><^v^><<^v>><^^v^vv^<>^^>^<<>^^>><^<^^<vv^>^vv><>^<v<<^<^<>><vv><><<v>v<v>v<^^^^^<<<v<>>v<<<v<v<><^>><v>^^^<<^^<>><^vv>vvvv^<>^<vv^v<v<v><>^<>vv^^<><<v<<<><^<^>^^vv>>v><<^<<>^<>^^><>^>>><<<^v><^v<^<vv<^^^v^vvvv^^^v>>^v>vv^^^<^^^>>vv^^>vv>><><^>>^>>v<^>^^>>>v><<<>^<<v>v<>v<>vvv<>^>>>^^>>v>>><<><>>v<^<v^v<>^^<>>>v>^<>^<<vv<<>^>>>^vv><vv>v^>>^^vv<<^v^>^v<^^^<>^^<v<><><vvvv<^<>>^v^<<^<>><>><v><>>v<v^^v<^v<<v^^>v^>vv<<v>>^<>vvv><<^><<>v^<>>>>vvv<vv^<>>v^>v^<>^<>^^^<^<^v<<vv^<v>>^v<v<v^<<^v<>v^v>><vv><<^<<^^>^<<^<^<<^<>^>^>v<^^><>vv<>v^^<vv^^^>^v<^^<^>>^<>v<v^>v^vv<^><<vv<>^<<<><<^<<<^<>v<<>>^>^<^^^v^<^^<>v><><<><^<>v^>^>^<<^v
        <v^^^<^^<v<<<^^^^<^^>v^><^><v^^^<<^^>>^v^v^^<>^<>v><>>vv^v<<>^<>v<^<>v>^^<^^>v^>>vv^><<>vv^^v<>^^^><^v^<>vv^v<>v^>^^^>^<^<v^vv<^^>>^<>^>>>>^<v><<<<>>v^^v>><>>v<<^^vv>><vvv^v<<^<^>^><>v><<<v<<><v<^v<^<<v>^^><v<<^^>v><v><><<>>v<^<^<<>>><<>v><^>vv>^^>v<vvv<^><>^<<>^^v<<<<v^^><>>><^><^v<^^<vv<vv^v^<>^vvv<^>>^>^vv^v<<^^vv>v><^^<>v>^><>v<v<>v<vv>^^v^<^^<>>>^^^>>>v^>vvv>v><<<><<>^v^vv<^>^v>vvv>v<>vvv^>v<v<^^>><<^v<>v<<<<<<^><v^>><v^><^<<<>vvv<v>><^>>^v><>^<vvv^^>^<>v<>>^v<^v>>>><>v>v^^>>vvv>vvvv<<^v<<v^v<^<>>^<^v>v^<>v>v^vv>v<><v>v<<vv>><v^<<<<>>vvv<<^v<vv^<><v><>>><v<v^^^v<>^>>^<<v><^^vv^^<v<>vvv><>>>>^^>v<v<v<<<v^v^<v>v>><<>^v<<^v^<^^^v<^<<^<^><^>^^<<^<<>vvv><><>><vv>^>><v<v<^^^v^>>v^<>>vv^>v<<><^>^><<>^^^v<^<<^^>v>>>^vv>vv^^>>vv^<^v^v^^>vv<v<v^<<>><<<v<<>>^^^>v<>><v^<<^<><^<<^v^^v>v<<^^<>v>v>^<>>>>v<v^^v^<><^^^^v^vv>v^v<^^v<>v>>>v>v<><>^>^v^<><v^>>^<>><><v>^><v<<<<<<>v^>^<>v<vvv<<v^<<v<^v^>v<>^^vv^<^><v<^<v>>^<<v^<^<<>^^^<<^^vvv><^>vvvv>v>^^^^><v^v>^<<vv^^><v^<^^><^v^^<v>>v^<<<v<<<v^>>><>>
        <^v^v<^v>v^^>>^>>^^<>>><^<^^<v>>><>^><^v>vv^<^<<<vvvv^>vv<<^^^>>v^v<v<v>^^<vvv>>v<vv^v>^>v>^vv^v>^v<>>^^v>>^>>^v><<>^v^>><<^^<vvv^<^v^^^^^>^v<^v<<<^<>><^vv^<<^<^^^^^v^>vvv><^^v<v>^^^^v^<<>>vv<<^<v<<>vv>>>>v>^v^<v<<^>v>v<^>v><>^^v<^^^^^<><v^v<^v<><>^^<^<^v>^^><<>v<v^>v><>^^<^<v><>v>^><^<>>>v>^vv>^><vv>v>v^<><^^<v<^>^^<<<^>vv^<v<^^<v>vv^^><vv^><<>^<>v>v>^vv<<^^^v^^>^<^<v<vvv<^v^v<^v>v^<<^^>>vv<v<<v<<><><^>v>^>v<<><^^^v^^<v>>>^^<<v^^^<>><<vv^vv^v><>><><><>>>><<>>>><<>^<>>v>^><^<>v<<v<>^>v>>v>vv>>>^^^>>>>v<>>^<^^^<^<^v>v^^<^>><^>^^v<<v>>>^<v<<v^>^<>^^v^>v<vvvv<<vv><>^^^<>>v<^<^^>^<^vv><>vv<^^vvv><v<^<vv>^v<<<>vv><><v<><vv>><<>v<v^<<<<>v^^<^>^>>><<<v<<v>v^<<<^v>v^<>vv<><><><>>^^v<v^><<<v><<<<v<>>v>^v^>v^^^<>vv<<<><<v^><>>^>v>v<v>>v<^^^>>vvv^<>^>v>>v>>v^<<>>^<<v<vv^v><>^>>>v^^^^vv^vv<<>vv<<vv<^^^^><><<v^^>^>^v<>v>^>^<v<<<^<v<<v^vv>v>>><<>^>vv^^<^v><v<><^>>vv>^^>^<^v<v^^vv>^><>>^>v^<<>^<^<v^><vv^^<^v<^v<<<<^^^^<^<v>>>^^^<v<><<>^><<<>v><<v^<vvv^vvvv>>v^<>>v<^>>^>^>><><^<><vv<<><><>v>^^v>^v<vv>
        <^<^<><v^^vv<<^^<><>><>>>v^^^vvv<v>v^><^<^^<^<><v<<v<>^v>v<><><^<<<^vvv><v<>^vv^<<<^><><v<^<<^v^><>>^v<v<v>>^v<v^^^<><^><vv<^>vv><v><>>>>^v<>>><^vv>v><><>v>>><v^><<^>v^>v><>>^<<v<^<<v<v>v>v<>^vv>v>^v<vv>v>>vv^v<>^>^>>>^^v^><<^>v^vv^>vvvv>vv^<vv<>vv<v>^>v^^v>^<<<v<>>^>^<>v<^^v><vv<<v^^vv^>v<^><<^><v<>>v^vv>^v>>>v<>^v<<<<vv^<v><^vvv^<^<<<<<<^<vv^>^v<v<>v<^vv<><v>>>^^<><v^^v<^<v^^^v<v><^>^v>v^v<>>^^^v<>^<v^v>v<>><^><>>><v^<>v>^v><^<>^<><>v^<^>v^v>><v^vv>>>>v^v<>^^vv^^><<>v^><^>v<<vv^<^<>><<v><>><>^vv<<<<<v^^^<><>v>><><<v<v><v<v<vv^<^^<v^vv<<>>^<v^^v^<<>><vv>^v<<v<>^>^vvv^v>vv^v>>><><<>>v>vv>><>^v>>>>>>v<<>>v^^v<<>>^<<>vvvvv<<><^^^v<^>v<^v<v>v^vv^><>v<^^v<>^<^<<^v^v^vv^vv^<<>^v>>>><<^>vvv>v^><>>v><^^v>^v<<v<^>v^^>vvv>>>>><vv>vv<v<><<^v^v<vv>^>v<>v>>v^><>>^>vvv<<vv^^><v<>><v>>vvvv^^<^v^v^<^<><<>^<^<v<^>v>v>^^>><^<v><v>><>^>>>>><vv>vv>>v^^v^>>^vv<v^<<><>^^<>>^>v<^<vv^^v^v^><<<v<<<>>>>^^^vv^<^><^<<><<>^^^<^vv>vv<<<^<>>>v^vvv<<<>><>^^^^vvvv<><<^><vvv>v>>v>^>^^v>v<^><<^><<<v>><>v^v<^v><<^<vv^<>
        ^<^<^v^<<>^v^>v^v>v>v><><><>v^^>>vvvv<v>v<v^^v^v>v^^v>v^>^^>>v^^^vv^>v<v>v^vvvv^<v^^vvv><v>^>^v>>>^<<^v<^>^>>^<^v>>v^<<>v^v^>>vv<vvv><<><>^>vvvvv<>>v^<v^<vv<>><><v<><^<v<vv<v^^^>vv><vvvv^^v^^<v<><vvv>^<^<v^v^^>>><<<v<><^v^^^^v^vvv>^v<>v^<><>><<v><<vv>v^><^<^^^^<><^^<<<><v<<<>vv^v<v>vv<>vv^>^^v>v<^>^<<^<>>^v<v^^<><v<v<^<<vv>>><<vv^<vv<<^>v<v^<<v>^<^><v><vvv^<<<^>>v<v<<>>v^<^>^>^>v^<<^<^^<<^^<>v<>><>v<>v<^>><^v<<<v>vv^v^^v><^<^<^v^<>><<v>>^^>^^^^v<^<v^^^v>^<>v>>v>^>v<>v>^^^v^>v^>vv<<<v<v^>^^><v>v><><>^<>>>^><^v<>^>v><vv^>><<<v>>vv>>v><<v><vv><^<^>^v^v><><^v^v><>>>>>vv<v<<>>^><>^<^v<><<^^<>v<v^^<>v^<v<^^<>v<^<^<^^>vv^>>vv^^<<<>><<^<v<<^<>v>v^<>>^^<v>v>^>^^<v>v>v>><>v<v>>>^v<<v<>vvv^^<>v<><>^>v><v<v<<<<^^v<>>^>v<^<>>^^v^^v<v^^<>^^>vvv^^v><v^<v<>><>v^>v>>v^>^<>vvv^^<v>v^vv>>>v^<^^<<^>^<>>>v<^^><v^>v><vv^<v>>^v<>^<^vv<^>><v^v>vvv<^>v<vv><v<^>vv^>>^>>^v^v<<>^^<<v><<^^<>v^^<^<>>^^<^>^>>>><>^^>v>^><^<^^<v^v^^v><>v>^^^^>><^^<^>^v><<^>^v>v^><<>v<<v>v<^^vvv<^^v^>>>^<<^<^<<v<^>>>^<<<vv>>^^<<<<^^>v>
        ^><^<<vvv>v>^<<><vv>^<<<<v^vv<^>^^^>^<><vv^^v<<v<v>>>v^^<v<^>v>^>^<vv>>v>^^<><^v<^^v>vv^vv^v^<<v^<<<><v>v<^<>v<v<^vv<v^^^>vv<^><^<v^^^^^<v^>vv>>v>><<><>v<<v>v<<>>vvvvvv<v<vv<>^^^^^<v>>><>^v^>v<<>v>v^^<^<><><>>>>^^>>v^<^<^>>v^<<>>vvv>^<^>^v^^v<^<^^>>v<<v<vv^^<v>^<^><^^>^^>v><><><<<^v<vvv<>v^>v^>>v>>>^>vvvvv<^^<>>>^vv<>^<^^<vv>v<<vv^>>v^><^>^><><v<vvv<>>>>v<v<>^<<^<<v><<>^<vv<>^^>v>v<<^>>><^<^<v^<<v^><<>v^^<>^><^><<^^v>><>v<^>>v><<<>^^^^<v<^^^>v^>^^<^<>^^>v^>^>v>>v^^>><^<><<v>vv>v<^<v<>><<>v<<<><vv^^^><^v<<<v^^>vvv^>>vv^v<v>^<^>^><^<^^^vv>>>v<^vvvv^v<vv<^^^<^v^><^<<^vv<v^^^v<<><<^<<<<^>^v^<<vv<vv>v>>^^^^><>>^^<^^^^>^<<^><^v^^>^>>v^^>^v>>v^<^v<><>>>^^^^v<><<^v^^^>v<vvv>vvvv><v>^<v^>v>>^>>^^<>vv>>v<<<^<>v>v>>^v^<v><^^<<^vv>v<vv^<v>^v<>>><v<v<<><v><^<><>>v><v<<v<>><^v><<>^^<<<v^>v><^<<<^>v>>vv<v^^v^>>^v^<vv<<^<^>v<v<<<vv<><<<><vv<vv^^^^^<^^<><<vv<>v<^>v^>>>>><^vv>^>vvvv<v<<>>v<<v^v<v>><<><>^>^^^vv>>v^>^<v<vv<v^<v>>><<^^v>^<<^vv<v><>^<^><^v>^<<v<^>^<^^>>>^^<><<<<>vv<^v>>>>v<<<>vv<<^v<^^<<<^^
        ^>vvv><v><<^>^^>>v>vv>vv<<>v^>>v><<>^<><<<^><>v>^^vvvv^^v^>vvvvv>v>>>v^^^>^^<<^^<<<^^vvv>>^v<>v>^v>^<^^>v><^^<<<^<>^v<vv^v>^v<^><v<^<<<<<^v<v<v^>v<v><><<>v^<v<^>v><<>^<^^v<<>^>v^^v>vv<<<^>vvv^<v^^v>v<v<<^^^^<<^<vvv>^>v>>>^<v^^<^^vv<^^>><v<<^^>^^v>v^v^^v^><^vvv<>v<<<>v<v<>><^vvv<><><<<vvv<<^v<>><v>v<^v^><v<v<>v<^v>^^<>v>^^<<<v^v^>^>^>><>v^^<v<>>^>^v<v<^<><<^^<v>><<^v>>v<><^<<<<<<<<<>>><>^^<vv<<v<>>v^^<^>v^<<v>^><^>><^v<<v>v><<<<<^vvv>vv^v<<<vv^^^<>>>>v^vv^v<v>><^>>^v>^v>v^^v<^v<vv>>^^^^>^>>>v^v<v^^>v<v^^v^>v^^vvv^>>v<^v^^^v>^>^v<^^<v^><v><><^>vv<^^<^>^>v<>>v<^^^<<><^^^v<>>v^v<>vv><v^vv>^^vv^>><<>^^^v^^^^^>><^v^^<><v<^v>v^v^>^v^^v>>>><v^^v><vv<<<<>vv^><<v^v><^^v><<^v^<^<^^>v^<>v^^v^>^>^<<>^^v<^^>>^<>><^v^>>^<><^^><v>^><<v>><vv>^>^v>>><<v><^>v^><v<v<v<v>^vv<^<<<<>^^>^>>>^><v<<><^v^><v^<vv^<v>>>><^v><^<<v^^<v>><<<>><vv>>><^^>>>>^^>>^^<v<<v>^>v<^vv<^>v>v^>>v^^^^vv><<v^^^v<><^<<^^<^vv<<v<^^><<<<<<<vv^^^v>vv<>v<v>v^^>v^^^>>><vv<^><^^v<<^vvvv^^>>><<v<v<<><^<<v^^><<<>>><>^<>^<<>>><vvv>><>^<>^<^
        vvv^^v>vv<vvv><v<v<^v<><v<>^<<v>v<vv^v^<v^^<^^<<^<^v<<vv^v<^^>v<vvv>^>^><<>^^vv><<>><>^>v^v>vvvvv^^^^><^>v<vv><^vv^^<<<v><v<<><<<vv<<v<>><<<><v^>>v^<>v^v>vvv^<<><>v>^^>^^><v>^vv<<<<^><>v><><><>>v^^^v>>>^vv^^^<^>^^>>^<^^^^<v><v><^^<v<v<vv<<^>>v^<v^<>><^<^v><<<vv>v<^v<^<^<vv>^v><v>v><<^<^>v>vvvv<<^>v>^^v>v^^v<<^<^v^>^><^^<><<^v<^v^<v^>>^>^v^^^v^v>^<<^v^>>>^v^<^v^><v><>^>^>^v<^<v^<^><<^^^<^<<>vv<>v^<<v^vv<vv>>^<>^>><<^><<v^^^^<>vv^^>vv<v><>v<^>v><>><<^v<<^>vv><^<v>>^v^v<v^^><>^v^<>^^>^><<v^v^v^>vvvv<><^<v^<<><v><><v^^v^v<v<^<<v>v^v^>>^v<^>^>^>v>^^>^^v^>><>>^v<^vv<<><^><^<>v>^^^>^>^<><<v<^>v<>v>v<vv<^^<<<<^<v<v<^^>v^<<<v><^>>v^>^>^^<^<>^>v><<<>v^vv<^><v^<v<<<^v^^<v<<^<<^>^>v^^vv<^^><>>v>><^^>^><<^^v<v<v<<>v^^<<^<^><^><vv^vv^^<v<<v><^<>v<v<v^v<<^^<^v>^^v^v><v><<v><>>^<v>^<^<v<v^v>^v><vv>v^<vv<^^<<^^^^<<^<vvv^>><v<<vv^<^^^><^^><^>^^v^^>^^vv<><<<<v^v>v>><>>>^<>>^<>>>vv<^^v>v><<^^^v<v>>^^^^>vv<>^>^<v^v^vv<>^>><<^^><^v<^^^^v<v>v>>>v<vv^^v^v><<^>v^<>^<^^<^<<v<^v<>>^>>v><v><>v^><>>>><^^vv^v><>><^
        v^><vv<<v<><>>^<<v^>><<^^^>><>^^^><<^^v<>v<>v<v>^>v<<>v^<^>^<><>^><^vvvv^vvv>>v>v^<>vvv^^>v^v^<v<^v><^<<<v>>>vv><vv<>vvv>^v<^v>^vv<<>>v<^<v><<<<>^^v<<^^<v^v^^^<v<v^>vv>^<<>>>^v><^^><<><^>^vvv>>^^^vv^v^^^^<^<<^vv<<<>v^<^^^v>^<v><<^<vv>>>v<<<<v>>>v<>v<^^^v<^v^<vv^vv<^><^v<>^<>><v^^^>vv^<^<v>>>v<^^v^>v^<v^>><<<^^><^^vv^>>^^vv<>v<^vv<<^<<>^^>^<<<<^<>v>>v^v<>^>vvv^>^>><^<v<^>>>v<<^>><>>>vvv^<><<<>><vv^><^<v^vv^>>^^<<<>v<v<>^<^>v>^v^<^^^v>^<vvvv<<<v<^>>>vv>v^><<v>v<^v<v^<^^>^<v<><<v^^<<^^^^<^>>>>v<<<<<^><^^vv>^v^v>>v>>>v^vv<vvvv<>v>v>><<>v>v>vv<<v<^v<vv<<vv<<^<<v<<v<^<>^^^>>>v<>^v>^<vv^v<>>><>^>>>v<^>^>^><<v^v<<v<<>vv<v><^v>v<v><>><^>^v<><v>^<>><<v^^^^v>^>v<v><<^>>v><>>><><v><>v^v>vvv^<<^><^>>v<^^<>^><>^v<^v<><>>>^^<>>>v>^>^<^v>><>^^<<v^^>>^^<v>>>^><<>><<^^v><v<>v><<>^^^v<><<vvv<<^^^vv^vv^>v<><v^<v^>^^^>>vv<>v^>^<^<^v^v><<v^^><^<>v<<vvv>^>>^><<v<<v^^v^^<<>>>^^^v>^>>vv^^v<><^<<^^<^v<<^v^v^>^v<<^^<^^<^<<<<vv<<<<v>v>^v^<^>v>v^>^>v<v^<<<vv>>^<<vv^>v<^>^<>>^v>v>>>v>>><v><<<v>v>^>v>>^^^>>>^^v>v>>v
    """.trimIndent()
    val parsed = parse(input)
    println(run1(parsed))
    println(run2(parsed))
}
